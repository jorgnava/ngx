!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@angular/common/http"),require("@ionic/storage"),require("@ionic/angular"),require("@angular/core")):"function"==typeof define&&define.amd?define("@okode/ngx-common",["exports","@angular/common/http","@ionic/storage","@ionic/angular","@angular/core"],n):n((e.okode=e.okode||{},e.okode["ngx-common"]={}),e.ng.common.http,e.storage,e.angular,e.ng.core)}(this,function(e,n,t,o,i){"use strict";var s=function(){return(s=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)};function a(n,s,a,c){return new(a||(a=Promise))(function(e,t){function o(e){try{i(c.next(e))}catch(n){t(n)}}function r(e){try{i(c["throw"](e))}catch(n){t(n)}}function i(n){n.done?e(n.value):new a(function(e){e(n.value)}).then(o,r)}i((c=c.apply(n,s||[])).next())})}function c(o,r){var i,s,a,e,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function t(e){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,s&&(a=2&e[0]?s["return"]:e[0]?s["throw"]||((a=s["return"])&&a.call(s),0):s.next)&&!(a=a.call(s,e[1])).done)return a;switch(s=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return c.label++,{value:e[1],done:!1};case 5:c.label++,s=e[1],e=[0];continue;case 7:e=c.ops.pop(),c.trys.pop();continue;default:if(!(a=0<(a=c.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){c=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){c.label=e[1];break}if(6===e[0]&&c.label<a[1]){c.label=a[1],a=e;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(e);break}a[2]&&c.ops.pop(),c.trys.pop();continue}e=r.call(o,c)}catch(n){e=[6,n],s=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([n,e])}}}var r=function(){function r(e,n,t,o){this.http=e,this.storage=n,this.actionSheetCtrl=t,this.platform=o,this.JSON_PATH="assets/environments.json",this.SELECTED_ENVIRONMENT_KEY="selectedEnvironmentKey",this.isInitializing=!1,this.readyPromiseResolve=[],this.readyPromiseReject=[]}return r.config=function(){return r.isReady||console.error("Environment config is not ready (wait for Environment.ready())"),r.environmentConfig},r.prototype.ready=function(){var t=this;return r.isReady?Promise.resolve():(this.isInitializing||(this.isInitializing=!0,this.initEnvs()),new Promise(function(e,n){t.readyPromiseResolve.push(e),t.readyPromiseReject.push(n)}))},r.prototype.initEnvs=function(){var r=this;this.http.get(this.JSON_PATH).subscribe(function(t){if(null==t||0===Object.keys(t).length)return r.readyPromiseReject.forEach(function(e){return e()}),void console.error("EnvironmentService fails: '"+r.JSON_PATH+"' is empty or invalid");var o=Object.keys(t).filter(function(e){return"default"!==e});null==o||0===o.length?r.setEnv(!1,"default",t["default"]):r.storage.ready().then(function(){r.storage.get(r.SELECTED_ENVIRONMENT_KEY).then(function(e){if(null==e)if(1<o.length)console.log("No saved environment detected, will prompt user for selection"),r.showEnvironmentActionSheet(o,t);else{var n=o[0];r.setEnv(!0,n,t["default"],t[n])}else console.log("Detected saved environment: "+e),r.setEnv(!1,e,t["default"],t[e])})})},function(e){console.log(e),console.error("EnvironmentService fails: Not found '"+r.JSON_PATH+"'"),r.readyPromiseReject.forEach(function(e){return e()})})},r.prototype.setEnv=function(e,n,t,o){console.log("Applying environment: "+n),r.environmentConfig=t,null!=o&&(r.environmentConfig=s({},t,o)),e&&(console.log("Saving environment: "+n),this.storage.set(this.SELECTED_ENVIRONMENT_KEY,n)),r.isReady=!0,this.readyPromiseResolve.forEach(function(e){return e()})},r.prototype.showEnvironmentActionSheet=function(t,o){return a(this,void 0,void 0,function(){var n=this;return c(this,function(e){switch(e.label){case 0:return[4,this.platform.ready()];case 1:return e.sent(),[4,this.actionSheetCtrl.create({header:"Select environment",backdropDismiss:!1,buttons:t.map(function(e){return{text:e,handler:function(){n.setEnv(!0,e,o["default"],o[e])}}})})];case 2:return e.sent().present(),[2]}})})},r.isReady=!1,r.environmentConfig={},r.decorators=[{type:i.Injectable}],r.ctorParameters=function(){return[{type:n.HttpClient},{type:t.Storage},{type:o.ActionSheetController},{type:o.Platform}]},r}(),u=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[r,{provide:i.APP_INITIALIZER,useFactory:l,deps:[r],multi:!0}]}},e.decorators=[{type:i.NgModule,args:[{declarations:[],imports:[],exports:[]}]}],e}();function l(n){var e=this;return function(){return a(e,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,n.ready()];case 1:return e.sent(),[2]}})})}}e.Environment=r,e.envInitializer=l,e.OkodeNgxCommonModule=u,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=okode-ngx-common.umd.min.js.map