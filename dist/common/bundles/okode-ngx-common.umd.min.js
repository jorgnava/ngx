!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common/http"),require("@ionic/storage"),require("@ionic/core/dist/collection/utils/transition/ios.transition"),require("@ionic/core/dist/collection/utils/transition/md.transition"),require("rxjs"),require("rxjs/operators"),require("@ionic/angular"),require("@angular/core")):"function"==typeof define&&define.amd?define("@okode/ngx-common",["exports","@angular/common/http","@ionic/storage","@ionic/core/dist/collection/utils/transition/ios.transition","@ionic/core/dist/collection/utils/transition/md.transition","rxjs","rxjs/operators","@ionic/angular","@angular/core"],e):e((t.okode=t.okode||{},t.okode["ngx-common"]={}),t.ng.common.http,t.storage,t.ios_transition,t.md_transition,t.rxjs,t.rxjs.operators,t.angular,t.ng.core)}(this,function(t,e,n,i,o,r,a,s,u){"use strict";var c=function(){return(c=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function l(e,a,s,u){return new(s||(s=Promise))(function(t,n){function i(t){try{r(u.next(t))}catch(e){n(e)}}function o(t){try{r(u["throw"](t))}catch(e){n(e)}}function r(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(i,o)}r((u=u.apply(e,a||[])).next())})}function f(i,o){var r,a,s,t,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),"throw":e(1),"return":e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function n(t){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,a&&(s=2&t[0]?a["return"]:t[0]?a["throw"]||((s=a["return"])&&s.call(a),0):a.next)&&!(s=s.call(a,t[1])).done)return s;switch(a=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,a=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){u=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){u.label=t[1];break}if(6===t[0]&&u.label<s[1]){u.label=s[1],s=t;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(t);break}s[2]&&u.ops.pop(),u.trys.pop();continue}t=o.call(i,u)}catch(e){t=[6,e],a=0}finally{r=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([e,t])}}}function d(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(i=r.next()).done;)a.push(i.value)}catch(s){o={error:s}}finally{try{i&&!i.done&&(n=r["return"])&&n.call(r)}finally{if(o)throw o.error}}return a}var p=function(){function o(t,e,n,i){this.http=t,this.storage=e,this.actionSheetCtrl=n,this.platform=i,this.JSON_PATH="assets/environments.json",this.SELECTED_ENVIRONMENT_KEY="selectedEnvironmentKey",this.isInitializing=!1,this.readyPromiseResolve=[],this.readyPromiseReject=[]}return o.config=function(){return o.isReady||console.error("Environment config is not ready (wait for Environment.ready())"),o.environmentConfig},o.prototype.ready=function(){var n=this;return o.isReady?Promise.resolve():(this.isInitializing||(this.isInitializing=!0,this.initEnvs()),new Promise(function(t,e){n.readyPromiseResolve.push(t),n.readyPromiseReject.push(e)}))},o.prototype.initEnvs=function(){var o=this;this.http.get(this.JSON_PATH).subscribe(function(n){if(null==n||0===Object.keys(n).length)return o.readyPromiseReject.forEach(function(t){return t()}),void console.error("EnvironmentService fails: '"+o.JSON_PATH+"' is empty or invalid");var i=Object.keys(n).filter(function(t){return"default"!==t});null==i||0===i.length?o.setEnv(!1,"default",n["default"]):o.storage.ready().then(function(){o.storage.get(o.SELECTED_ENVIRONMENT_KEY).then(function(t){if(null==t)if(1<i.length)console.log("No saved environment detected, will prompt user for selection"),o.showEnvironmentActionSheet(i,n);else{var e=i[0];o.setEnv(!0,e,n["default"],n[e])}else console.log("Detected saved environment: "+t),o.setEnv(!1,t,n["default"],n[t])})})},function(t){console.log(t),console.error("EnvironmentService fails: Not found '"+o.JSON_PATH+"'"),o.readyPromiseReject.forEach(function(t){return t()})})},o.prototype.setEnv=function(t,e,n,i){console.log("Applying environment: "+e),o.environmentConfig=n,null!=i&&(o.environmentConfig=c({},n,i)),t&&(console.log("Saving environment: "+e),this.storage.set(this.SELECTED_ENVIRONMENT_KEY,e)),o.isReady=!0,this.readyPromiseResolve.forEach(function(t){return t()})},o.prototype.showEnvironmentActionSheet=function(n,i){return l(this,void 0,void 0,function(){var e=this;return f(this,function(t){switch(t.label){case 0:return[4,this.platform.ready()];case 1:return t.sent(),[4,this.actionSheetCtrl.create({header:"Select environment",backdropDismiss:!1,buttons:n.map(function(t){return{text:t,handler:function(){e.setEnv(!0,t,i["default"],i[t])}}})})];case 2:return t.sent().present(),[2]}})})},o.isReady=!1,o.environmentConfig={},o.decorators=[{type:u.Injectable}],o.ctorParameters=function(){return[{type:e.HttpClient},{type:n.Storage},{type:s.ActionSheetController},{type:s.Platform}]},o}(),h=function(){function t(t,e){this.navCtrl=t,this.config=e,this.animation="default",this.animationConfigReady=!1,this.startNavFlow=!1,this.defaultAnimation="default"}return t.prototype.getParams=function(){return this.params},t.prototype.push=function(t,e,n,i){return void 0===n&&(n="default"),void 0===i&&(i=!1),this.animationConfigReady||this.setAnimationConfig(),this.params=e,this.animation=n,this.startNavFlow=i,this.navCtrl.navigateForward(t)},t.prototype.pop=function(t,e){this.params=e;var n=t||this.getPreviousPageUrl();return n?this.navCtrl.navigateBack(n):Promise.resolve(!1)},t.prototype.popToRoot=function(){return this.navCtrl.navigateBack(this.getRootPageUrl())},t.prototype.setRoot=function(t,e){return this.params=e,this.navCtrl.navigateRoot(t)},t.prototype.closeCurrentNavFlow=function(t){var e=function o(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(d(arguments[e]));return t}(this.getViews()).reverse(),n=e.findIndex(function(t){return t.element.getAttribute("new-nav-flow")}),i=0<=n&&1<e.length?e[n+1]:null;return i?this.pop(i.url,t):this.popToRoot()},t.prototype.getViews=function(){var t=c({},this.navCtrl),e=[];return t&&t.topOutlet&&t.topOutlet.stackCtrl&&(e=t.topOutlet.stackCtrl.views),e},t.prototype.setDefaultAnimation=function(t){this.defaultAnimation=t},t.prototype.getPreviousPageUrl=function(){var t=this.getViews();return t&&1<t.length?t[t.length-2].url:null},t.prototype.getRootPageUrl=function(){var t=this.getViews();return t&&t.length?t[0].url:""},t.prototype.setAnimationConfig=function(){var s=this;this.animationConfigReady=!0,this.config.set("navAnimation",function(t,e,n){var i=s.animation;"back"===n.direction?i=n.enteringEl.getAttribute("animation-leave"):"forward"===n.direction&&s.startNavFlow&&(n.enteringEl.setAttribute("new-nav-flow",!0),s.startNavFlow=!1),n.enteringEl.setAttribute("animation-enter",s.animation),n.leavingEl.setAttribute("animation-leave",s.animation);var o=n&&"ios"===n.mode;switch("default"===i&&(i=s.defaultAnimation),i){case"default":return o?v(t,e,n):m(t,e,n);case"push":return v(t,e,n);case"modal":return m(t,e,n);case"fade":return function r(t,e,n){return g(t,e,n)}(t,e,n);case"safepush":return function a(t,e,n){return y(t,e,n)}(t,e,n);default:return m(t,e,n)}})},t.decorators=[{type:u.Injectable}],t.ctorParameters=function(){return[{type:s.NavController},{type:s.Config}]},t}();function v(t,e,n){return i.iosTransitionAnimation(t,e,n)}function m(t,e,n){return o.mdTransitionAnimation(t,e,n)}function g(t,e,n){function i(t){return t.classList.contains("ion-page")?t:t.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")||t}var o=n.enteringEl,r=n.leavingEl,a=i(o),s=new t;s.addElement(a).beforeRemoveClass("ion-page-invisible"),"back"===n.direction?s.duration(n.duration||300).easing("cubic-bezier(0.47,0,0.745,0.715)"):s.duration(n.duration||400).easing("cubic-bezier(0.36,0.66,0.04,1)").fromTo("opacity",.01,1,!0);var u=a.querySelector("ion-toolbar");if(u){var c=new t;c.addElement(u),s.add(c)}if(r&&"back"===n.direction){s.duration(n.duration||300).easing("cubic-bezier(0.47,0,0.745,0.715)");var l=new t;l.addElement(i(r)).fromTo("opacity",1,0),s.add(l)}return Promise.resolve(s)}function y(t,e,n){function i(t){return t.classList.contains("ion-page")?t:t.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")||t}var o=n.enteringEl,r=n.leavingEl,a=i(o),s=new t;s.addElement(a).beforeRemoveClass("ion-page-invisible"),s.duration(n.duration||500).easing("cubic-bezier(0.36,0.66,0.04,1)");var u=new t,c=new t;return"back"===n.direction?(u.addElement(i(r)).fromTo("translateX","0","100%"),c.addElement(i(o)).fromTo("translateX","-100%","0")):(u.addElement(i(r)).fromTo("translateX","0","-100%"),c.addElement(i(o)).fromTo("translateX","100%","0")),s.add(u),s.add(c),Promise.resolve(s)}var b=function(){function t(t,e,n){this.navCtrl=t,this.nav=e,this.platform=n,this.filterCondition=function(){return!0},this.intialized=!1}return t.prototype.enable=function(t){this.intialized||this.init(),this.filterCondition=t||function(){return!0}},t.prototype.disable=function(){this.intialized||this.init(),this.filterCondition=function(){return!1}},t.prototype.init=function(){var t=this;this.intialized=!0;var e=new r.Subject;e.pipe(a.throttleTime(500),a.filter(function(){return t.filterCondition()})).subscribe(function(){return l(t,void 0,void 0,function(){var e,n;return f(this,function(t){switch(t.label){case 0:return console.log("HardwareBackButton: back button action"),"ion-alert-controller, ion-action-sheet, ion-loading-controller",(e=document.querySelector("ion-alert-controller, ion-action-sheet, ion-loading-controller"))&&e.getTop?[4,e.getTop()]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return e?e&&!0===e.backdropDismiss&&e.dismiss():(n=this.getActiveViewRefInstance())&&n.kdOnHardwareBackButton?n.kdOnHardwareBackButton():this.nav.pop(),[2]}})})}),this.platform.ready().then(function(){t.platform.backButton.subscribeWithPriority(9999,function(){e.next(event)})})},t.prototype.getActiveViewRefInstance=function(){var t=c({},this.navCtrl);return t&&t.topOutlet&&t.topOutlet.stackCtrl&&t.topOutlet.stackCtrl.activeView&&t.topOutlet.stackCtrl.activeView&&t.topOutlet.stackCtrl.activeView.ref?t.topOutlet.stackCtrl.activeView.ref.instance:null},t.decorators=[{type:u.Injectable}],t.ctorParameters=function(){return[{type:s.NavController},{type:h},{type:s.Platform}]},t}(),w=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[p,h,b,{provide:u.APP_INITIALIZER,useFactory:E,deps:[p],multi:!0}]}},t.decorators=[{type:u.NgModule,args:[{declarations:[],imports:[],exports:[]}]}],t}();function E(e){var t=this;return function(){return l(t,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,e.ready()];case 1:return t.sent(),[2]}})})}}t.Environment=p,t.fadeAnimation=g,t.safePushAnimation=y,t.Navigator=h,t.HardwareBackButton=b,t.moduleInitializer=E,t.OkodeNgxCommonModule=w,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=okode-ngx-common.umd.min.js.map